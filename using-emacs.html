<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-04-28 Mon 21:16 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Working inside emacs</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/search.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/search.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Working inside emacs</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org20bdc13">1. Emacs tab</a></li>
<li><a href="#org7921e10">2. Merge my linux and mac configuration</a></li>
<li><a href="#orga79ab56">3. Set transparent background</a></li>
<li><a href="#org4de6b75">4. Set up emacs to load pkgs installed from nix</a>
<ul>
<li><a href="#org342d3ae">4.1. First solution</a></li>
<li><a href="#org515b488">4.2. Second solution</a></li>
</ul>
</li>
<li><a href="#orgd03949e">5. How to code per file</a></li>
<li><a href="#org36aae44">6. How to scroll inside vterm</a></li>
<li><a href="#orge0a6e9e">7. Setting compilation environment variable</a></li>
</ul>
</div>
</div>
<div id="outline-container-org20bdc13" class="outline-2">
<h2 id="org20bdc13"><span class="section-number-2">1.</span> Emacs tab</h2>
<div class="outline-text-2" id="text-1">
<blockquote>
<p>
How I manually insert tabs inside emacs ?
</p>
</blockquote>

<p>
Emacs prevents inserting tabs, I think it's because the key is bound to complete when you set the variable <code>indent-tabs-mode</code> to nil.
</p>

<blockquote>
<p>
Why would you set this variable to nil ?
</p>
</blockquote>

<p>
This variable permit to complete inside minibuffer or the buffer when you type tab, it's pretty handy as its the default that people are used to from other editors.
</p>


<blockquote>
<p>
How to then manually insert your tabs ?
</p>
</blockquote>

<p>
You can use the key sequence <code>C-q &lt;tab&gt;</code> to insert a tab, but electric-mode will cause you some ugly indentation for the next lines.
</p>

<p>
The second solution is to use the interactive function <code>tab-to-tab-stop</code>. It permit to go to the next tab-stop.
</p>

<p>
I bound this function to the key <code>C-&lt;tab&gt;</code> so that I can quickly insert tabs wherever I want :   <code>(global-set-key (kbd "C-&lt;tab&gt;") 'tab-to-tab-stop)</code>
</p>
</div>
</div>
<div id="outline-container-org7921e10" class="outline-2">
<h2 id="org7921e10"><span class="section-number-2">2.</span> Merge my linux and mac configuration</h2>
<div class="outline-text-2" id="text-2">
<blockquote>
<p>
How to execute a elisp bloc depending on whether you're on mac or linux ?
</p>
</blockquote>


<p>
The variable <code>system-type</code> is set to your current system.
</p>

<p>
<code>darwin</code> for macos and <code>gnu/linux</code> for linux.
</p>

<p>
You just have to use a condition depending on what you want to execute on the current system.
</p>

<p>
Example :
</p>

<pre class="example" id="orgb25bc99">
(cond
 ((eq system-type 'darwin)  ;; macOS
  (setq read-process-output-max (* 64 1024)))  ;; 64KB
 ((eq system-type 'gnu/linux)  ;; Linux
  (setq read-process-output-max (* 1024 1024)))  ;; 1MB
 )
</pre>


<blockquote>
<p>
Do not forget variable like <code>user-emacs-directory</code> that helps you and diminishes the use of the conditional statements.
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orga79ab56" class="outline-2">
<h2 id="orga79ab56"><span class="section-number-2">3.</span> Set transparent background</h2>
<div class="outline-text-2" id="text-3">
<blockquote>
<p>
How to set transparent background in emacs ?
</p>
</blockquote>


<p>
To set transparent background in emacs, there are two methods, only one works for each systems (in my experience).
</p>

<p>
On linux, what worked for me :
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-frame-parameter nil 'alpha-background 60)
(add-to-list 'default-frame-alist '(alpha-background . 60))
</pre>
</div>

<p>
On mac, what worked :
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-frame-parameter (selected-frame) 'alpha '(92 . 50))
(add-to-list 'default-frame-alist '(alpha . (92 . 50))))
</pre>
</div>
</div>
</div>
<div id="outline-container-org4de6b75" class="outline-2">
<h2 id="org4de6b75"><span class="section-number-2">4.</span> Set up emacs to load pkgs installed from nix</h2>
<div class="outline-text-2" id="text-4">
<blockquote>
<p>
How to load the packages that you installed from nix inside emacs ?
</p>

<p>
We're not talking about command line packages, but emacs packages. Such packages should not make modification to any path, unless you want an impure environment.
</p>
</blockquote>
</div>
<div id="outline-container-org342d3ae" class="outline-3">
<h3 id="org342d3ae"><span class="section-number-3">4.1.</span> First solution</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The first solution, which is the simplest, is to just open a devshell, in which you've installed and initialize the emacs packages. An example for julia environment
</p>


<div class="org-src-container">
<pre class="src src-nix">{
  description = "Environment to code in Julia";

  inputs = {
    nixpkgs.url = "github:nixos/nixpkgs?ref=nixos-unstable";
    flake-utils.url = "github:numtide/flake-utils";
  };

  outputs = { self, nixpkgs, flake-utils }:
    flake-utils.lib.eachDefaultSystem (system:
      let 
        pkgs = import nixpkgs { inherit system; };
      in {
        devShell = pkgs.mkShell {
          nativeBuildInputs = with pkgs; [
            julia-bin
            emacsPackages.julia-ts-mode
            bc
          ];

          shellHook = ''
            julia -e 'import Pkg; Pkg.add("DebugAdapter")' \
            julia -e 'import Pkg; Pkg.add("LanguageServer")' \
            emacs --batch --eval "(progn (package-initialize))" \
            echo "My julia environment for coding"
          '';
        };
      }
    );
}
</pre>
</div>

<p>
The packages should be present and loaded after your run `emacs &amp;` in the dev shell.
</p>
</div>
</div>
<div id="outline-container-org515b488" class="outline-3">
<h3 id="org515b488"><span class="section-number-3">4.2.</span> Second solution</h3>
<div class="outline-text-3" id="text-4-2">
<blockquote>
<p>
Why bother with this second solution ?
</p>

<p>
While building the dev environment using nix, the first solution demands to quit emacs, make your changes and reload emacs to check if all is correctly setup. That was such a pain that I decided to find a solution. (I hate doing the same things in repitition)
</p>
</blockquote>


<p>
The second solution involves using packages like <code>envrc</code> (the one I use) or <code>direnv</code> (an alternative).
</p>

<p>
I use <a href="https://github.com/purcell/envrc">envrc</a> becauses it loaded the variables from direnv at a buffer level instead of inserting them to emacs global state.
</p>

<p>
My configuration looks like :
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package envrc
    :config
    (envrc-global-mode))
</pre>
</div>


<p>
For this to work, you should have the direnv binary, an <code>.envrc</code> file inside your root dir, and had allowed direnv to automatically load your shell environment. Details here :  <a href="https://nix.dev/guides/recipes/direnv.html">nix direnv workflow</a> and <a href="https://direnv.net/">direnv documentation</a>
</p>

<p>
The fact is, with this method, the binary will be inside the path of emacs and you'll be able to use them, but not the emacsPackages, because the load-path will not gets populate with those packages root directories.
</p>

<p>
The workaround I found for this is to add those directories to the load path with some elisp code. Here is my custom function that does that :
</p>


<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun smv/add-nix-pkg-to-lpath (PKG_ENV)
    "Load the PKG_ENV directory to the load path of current emacs session
    it permits to then require the package"

    (let ((pkg-nix-path (getenv PKG_ENV)))

      (unless pkg-nix-path
        (user-error "Environment variable '%s' is not set" PKG_ENV))

      (let ((pkg-suffix "/share/emacs/site-lisp/elpa/"))

        (string-match "-emacs-\\([^/]+\\)" pkg-nix-path)

        (let* ((pkg-full-path (match-string 1 pkg-nix-path))
               (path-to-add (concat pkg-nix-path pkg-suffix pkg-full-path)))
          (unless (member path-to-add load-path)
            (add-to-list 'load-path path-to-add))))))
</pre>
</div>


<p>
Depending on some environment variable it add the "/share/emacs/site-elisp/elpa/&lt;package-name&gt;" directory of this environment variable to the load path.
</p>

<p>
The required environment variable here is the nix-path of the package you want to load.
</p>

<p>
How I use it ?
</p>

<div class="org-src-container">
<pre class="src src-nix">{
  ...
        devShell = pkgs.mkShell {
          nativeBuildInputs = with pkgs; [
            julia-bin
            emacsPackages.julia-ts-mode
            bc
          ];

          shellHook = ''
            export EMACS_JULIATS = "${pkgs.emacsPackages.julia-ts-mode}"
            echo "My julia environment for coding"
          '';
        };

   ...
}
</pre>
</div>

<p>
Look at the <code>shellHook</code> bloc, I've defined a shell environment variable that will be buffer available when envrc will run direnv.
</p>

<p>
Then you can call my custom function using this variable as an argument. For example :
</p>

<p>
<code>(smv/add-nix-pkg-to-lpath EMACS_JULIATS)</code>
</p>

<p>
You can add such call to your .dir-locals.el file inside the root directory of your project and that's it.
</p>
</div>
</div>
</div>
<div id="outline-container-orgd03949e" class="outline-2">
<h2 id="orgd03949e"><span class="section-number-2">5.</span> How to code per file</h2>
<div class="outline-text-2" id="text-5">
<p>
This notes that I take requires me to modify my index.html file each time. I could've use a command to trigger the modification automatically. But the solution that came up first into my mind was to create a snippet that will only be available in that file. This way I can open my file add my new entry and that's it.
</p>

<p>
To execute some code on a directory level in emacs you could use a file called <code>.dir-locals.el</code>, to execute code in a per-file basis you use a <code>;; -*- eval: &lt;code&gt; ; -*-</code> on top of that file.
</p>

<p>
eval means evaluate, you could set others things, such as the mode, with <code>mode</code> like <code>mode: lisp</code> for example.
</p>

<p>
So here's what I wrote on top on my file, it uses the <code>auto-yasnippet</code>'s package variable <code>aya-current</code>  :
</p>

<p>
<code>;; -*- eval: (progn (setq aya-current "&lt;li&gt;&lt;a href=\"${1:org-file-name}.html\"&gt;${2:title}&lt;/a&gt;&lt;/li&gt;")); -*-</code>
</p>
</div>
</div>
<div id="outline-container-org36aae44" class="outline-2">
<h2 id="org36aae44"><span class="section-number-2">6.</span> How to scroll inside vterm</h2>
<div class="outline-text-2" id="text-6">
<p>
vterm has multiple mode, it's not like eshell that permits you to scroll without restriction inside the terminal.
</p>

<p>
In vterm, you should switch to the copy-mode to be able to scroll inside the terminal.
</p>

<p>
The default binding for that is : <code>C-c C-t</code>
</p>
</div>
</div>
<div id="outline-container-orge0a6e9e" class="outline-2">
<h2 id="orge0a6e9e"><span class="section-number-2">7.</span> Setting compilation environment variable</h2>
<div class="outline-text-2" id="text-7">
<p>
When you're coding inside emacs you might want to run some commands using the project-compile command, which is really powerfull.
Sometimes you might want to set some compilation environment that is only needed during this command evaluation process, you don't need that variable outside. For example you might want to add some path to the PYTHONPATH for your project to correctly run.
</p>

<p>
To set those kind of commands, pay attention to the fact that using the "$PYTHONPATH" formula will not work. Prefer setting the environment by retrieving the variable value then add the new string to it.
</p>

<p>
What I mean is :
</p>

<p>
Prefer : <code>(setq compilation-environment (list (concat "PYTHONPATH=" (getenv "PYTHONPATH") ":" (expand-file-name "./src"))))</code> or <code>(setq compilation-environment (list (concat "PYTHONPATH=" (getenv "PYTHONPATH") ":./src")))</code>
</p>

<p>
instead of : <code>(setq compilation-environment '("PYTHONPATH=$PYTHONPATH:./src"))</code>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2025-04-28 Mon 21:16</p>
</div>
</body>
</html>
